<!DOCTYPE html>
<html lang="en">
<head>
<title>let and const</title>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/global.css">
<style type="text/css" media="screen">
  .editor-holder {
    position: relative;
    height: 500px;
  }
  #editor { 
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      font-size: 18px;
  }
  #console {
    color: #2D8730;
    font-family: "Monaco","Menlo","Ubuntu Mono","Consolas","source-code-pro",monospace;
    font-size: 18px;
  }
  #console pre {
    margin: 0 0 3px 0;
    padding: 0;
  }
  #console pre.error {
    color: red;
  }
</style>
</head>
<body>

<div class="editor-holder">
  <div id="editor">console.log('hello, curtis');</div>
</div>
<button id="run" class="pure-button pure-button-primary"><span class="fa fa-play"></span> Run</button>
<div id="console"></div>
    
<script src="https://google.github.io/traceur-compiler/bin/traceur.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mousetrap/1.4.6/mousetrap.min.js"></script>
<script>
  'use strict';
  var editor, log, flush, prefix, listener, _log;

  function saveHandler(e) {
    e.preventDefault();
    document.getElementById('run').click();
  }

  editor = ace.edit('editor');
  editor.setTheme('ace/theme/twilight');
  editor.getSession().setTabSize(2);
  editor.getSession().setMode('ace/mode/javascript');

  editor.container.getElementsByTagName('textarea')[0].addEventListener('keydown', function (e) {
    if (e.which === 83 && (e.metaKey || e.ctrlKey)) {
      saveHandler(e);
    }
  });

  log = '';
  _log = console.log.bind(console);
  console.log = function (t) {
    var o = t;
    if (t.toString() === '[object Object]') {
      t = JSON.stringify(t);
    }
    _log(o);
    log += '<pre>[' + prefix + ']&gt; ' + t.toString() + '</pre>';
  };
  flush = function () {
    var c = document.getElementById('console');
    c.innerHTML += log;
    log = '';
  };

  console.error = function (t) {
    var c = document.getElementById('console');
    c.innerHTML += '<pre class="error">[' + prefix + ']&gt; ' + t.toString() + '</pre>';
  };

  Mousetrap.bind([ 'ctrl+s', 'command+s' ], saveHandler);
  traceur.options.experimental = true;

  document
    .getElementById('run')
    .addEventListener('click', listener = function () {
      prefix = 'traceur';
      var c, options;
      c = editor.getValue();
      options = {
        address: 'foo',
        name: 'foo',
        referrer: window.location.href,
        traceurOptions: traceur.options
      };
      try {
        System.module(c, options).then(function (m) {
          flush();
        });
      } catch (e) {
        log = '';
        console.error(e.message);
      }
    });
</script>
<script type="application/javascript;version=1.7">
  (function () {
    var run = document.getElementById('run');
    run.removeEventListener('click', listener);
    run.addEventListener('click', () => {
      prefix = 'native';
      try {
        eval('"use strict";' + editor.getValue());
        flush();
      } catch (e) {
        log = '';
        console.error(e.message);
      }
    });
  }());
</script>
</body>
</html>